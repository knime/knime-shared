---
# This is the Swagger spec, describing the KNIME gateway.  
swagger: "2.0"
info:
  title: KNIME Gateway API
  version: 1.0.0
  description: Gateway operations on KNIME workflows.
basePath: /v4/jobs/{job-id}

# not used in gateway code generation so far
schemes:
- http
- https

# E.g. gateway-service interfaces are created from the tags, such as WorkflowService or NodeService
tags:
- name: Workflow
  description: Operations on workflows.
- name: Node
  description: Operations on single nodes.
  
parameters:
 job-id:
  name: job-id
  in: path
  description: ID the job the workflow is requested for
  required: true
  type: string
  format: uuid

# Remark on the responses for the operation: only the 200-response affects the gateway-code generation 
# by defining the operations return type. The other responses are for documentation purposes.
# The x-knimegateway-exceptions are meant for the gateway-code-generation.
paths:

  # the workflow endpoint
  /workflow:
    get:
      tags:
      - Workflow
      description: Retrieves the complete structure (nodes, connections, annotations) of the workflow
      operationId: getWorkflow
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
      responses:
        200:
          description: Successful response, with a representation of the workflow accompanied by a snapshot id. The snapshot id allows to subsequently retrieve workflow changes only using the workflow-diff endpoints.
          schema:
            $ref: "#/definitions/WorkflowSnapshot"
      x-knimegateway-exceptions:
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"

  # endpoint for workflow changes (i.e. diff)
  /workflowdiff:
    get:
      tags:
      - Workflow
      description: Gives the changes of the workflow as patch. Please note that there is not always a snapshot available for the provided snapshot id, either because the snapshot never existed or has expired.
      operationId: getWorkflowDiff
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: snapshot-id
          in: query
          description: The id of the workflow snapshot already retrieved.
          required: true
          type: string
          format: uuid
      responses:
        200:
          description: Successful response, with a patch containing all the changes.
          schema:
            $ref: "#/definitions/Patch"
        404:
          $ref: "#/responses/NotFound"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NotFound"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"

  # the sub-workflow endpoint
  /workflow/{node-id}:
    get:
      tags:
      - Workflow
      description: Retrieves the complete structure (nodes, connections, annotations) of sub-workflows.
      operationId: getSubWorkflow
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node this sub-workflow is requested for.
            For nested sub-workflows the node id's are concatenated with an ':' (e.g. 6:4:3).
          required: true
          type: string
      responses:
        200:
          description: Successful response, with a representation of the sub-workflow.
          schema:
            $ref: "#/definitions/WorkflowSnapshot"
        400:
            $ref: "#/responses/NotASubWorkflow"
        404:
            $ref: "#/responses/NodeNotFound"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NotASubWorkflow"
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
          
  # endpoint for SUB-workflow changes (i.e. diff)
  /workflowdiff/{node-id}:
    get:
      tags:
      - Workflow
      description: Gives the changes of the sub-workflow as a patch. 
      operationId: getSubWorkflowDiff
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node this sub-workflow is requested for.
            For nested sub-workflows the node id's are concatenated with an ':' (e.g. 6:4:3).
          required: true
          type: string
        - name: snapshot-id
          in: query
          description: The id of the workflow snapshot already retrieved.
          required: true
          type: string
          format: uuid
      responses:
        200:
          description: Successful response, with a patch containing all the changes.
          schema:
            $ref: "#/definitions/Patch"
        400:
            $ref: "#/responses/NotASubWorkflow"
        404:
            $ref: "#/responses/NotFound"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NotASubWorkflow"
          - $ref: "#/x-knimegateway-exceptions/executor/NotFound"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"

   
  # the root node endpoint
  /workflow/node:
     get:
      tags:
      - Node
      description: Retrieves the root node referencing the workflow
      operationId: getRootNode
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
      responses:
        200:
          description: Successful response, with a representation of the Node.
          schema:
            $ref: "#/definitions/Node"
        403:
          $ref: "#/responses/NoPermission"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
  
  #the node endpoint
  /workflow/node/{node-id}:
    get:
      tags:
      - Node
      description: Retrieves the node for the given node-id.
      operationId: getNode
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node the information is requested for.
          required: true
          type: string
      responses:
        200:
          description: Successful response, with a representation of the Node.
          schema:
            $ref: "#/definitions/Node"
        403:
          $ref: "#/responses/NoPermission"
        404:
          $ref: "#/responses/NodeNotFound"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
          
  # endpoint for node settings        
  /workflow/node/{node-id}/settings:
    get:
      tags:
      - Node
      description: Retrieves the node's settings for the given node-id.
      operationId: getNodeSettings
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node the information is requested for.
            For nested nodes the node ids are concatenated with an ':', e.g. 3:6:4
          required: true
          type: string
      responses:
        200:
          description: Successful response, with a json-representation of the settings
          schema:
            $ref: "#/definitions/NodeSettings"
        403:
          $ref: "#/responses/NoPermission"
        404:
          $ref: "#/responses/NodeNotFound"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
    put:
      tags:
      - Node
      description: Sets the node's settings for the given node-id.
      operationId: setNodeSettings
      consumes:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node the information is requested for.
            For nested nodes the node ids are concatenated with an ':', e.g. 3:6:4
          required: true
          type: string
        - name: node-settings
          in: body
          description: The node settings to set.
          schema:
            $ref: "#/definitions/NodeSettings"
      responses:
        204:
          description: Settings successfully set.
        403:
          $ref: "#/responses/NoPermission"
        404:
          $ref: "#/responses/NodeNotFound"
        405:
          $ref: "#/responses/InvalidSettings"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
          - $ref: "#/x-knimegateway-exceptions/executor/InvalidSettings"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
          
          
  # endpoint for node's state and actions to change it (e.g. execute, cancel, reset)      
  /workflow/node/{node-id}/state:
    post:
      tags:
      - Node
      description: Retrieves and manipulates the node's state for the given node-id.
      operationId: changeAndGetNodeState
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node the information is requested for.
            For nested nodes the node ids are concatenated with an ':', e.g. 3:6:4
          required: true
          type: string
        - name: action
          description: The action (reset, cancel, execute) to be performed in order to change the node's state.
          in: query
          type: string
          enum: [reset, cancel, execute]
      responses:
        200:
          description: Successful response, with the current node's state.
          schema:
            type: string
        403:
          $ref: "#/responses/NoPermission"
        404:
          $ref: "#/responses/NodeNotFound"
        405:
          $ref: "#/responses/ActionNotAllowed"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
          - $ref: "#/x-knimegateway-exceptions/executor/ActionNotAllowed"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
          
  # endpoint for node port specification        
  /workflow/node/{node-id}/output/specs:
    get:
      tags:
      - Node
      description: Provides the node's output port specifications for the given node-id.
      operationId: getOutputPortSpecs
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node the information is requested for.
            For nested nodes the node ids are concatenated with an ':', e.g. 3:6:4
          required: true
          type: string
      responses:
        200:
          description: Successful response, with a list of json-representations of the port object specs.
          schema:
            type: array
            items:
              $ref: "#/definitions/PortObjectSpec"
        403:
          $ref: "#/responses/NoPermission"
        404:
          $ref: "#/responses/NodeNotFound"
        405:
          $ref: "#/responses/NotSupported"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
          - $ref: "#/x-knimegateway-exceptions/executor/NotSupported"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
          
  # endpoint for node port specification        
  /workflow/node/{node-id}/input/specs:
    get:
      tags:
      - Node
      description: Provides the node's input port specifications for the given node-id. I.e. all output port specs of the output ports connected to the input ports of this node.
      operationId: getInputPortSpecs
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node the information is requested for.
            For nested nodes the node ids are concatenated with an ':', e.g. 3:6:4
          required: true
          type: string
      responses:
        200:
          description: Successful response, with a list of json-representations of the port object specs.
          schema:
            type: array
            items:
              $ref: "#/definitions/PortObjectSpec"
        403:
          $ref: "#/responses/NoPermission"
        404:
          $ref: "#/responses/NodeNotFound"
        405:
          $ref: "#/responses/NotSupported"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
          - $ref: "#/x-knimegateway-exceptions/executor/NotSupported"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout"
          
  # endpoint for flow variables of a node        
  /workflow/node/{node-id}/input/flowvariables:
    get:
      tags:
      - Node
      description: Provides the node's flow variables available for the node with the given node-id.
      operationId: getInputFlowVariables
      produces:
      - application/json
      parameters:
        - $ref: "#/parameters/job-id"
        - name: node-id
          in: path
          description: The ID of the node the information is requested for.
            For nested nodes the node ids are concatenated with an ':', e.g. 3:6:4
          required: true
          type: string
      responses:
        200:
          description: Successful response, with a all flow variables available
          schema:
            type: array
            items:
              $ref: "#/definitions/FlowVariable"
        403:
          $ref: "#/responses/NoPermission"
        404:
          $ref: "#/responses/NodeNotFound"
        504:
          $ref: "#/responses/Timeout"
        505:
          $ref: "#/responses/InternalServerError"
      x-knimegateway-exceptions:
        executor:
          - $ref: "#/x-knimegateway-exceptions/executor/NodeNotFound"
        server:
          - $ref: "#/x-knimegateway-exceptions/server/NoPermission"
          - $ref: "#/x-knimegateway-exceptions/server/ExecutorException"
          - $ref: "#/x-knimegateway-exceptions/server/IOException"
          - $ref: "#/x-knimegateway-exceptions/server/Timeout" 
    
        
# Collection of java-exceptions for the gateway code generation.
# For every server-exception a respective exception mapper must be provided (TODO: could probably be auto-generated).
# The exception fall into the following categories:
#   executor: exceptions that are thrown at the executor
#   server: exceptions that are thrown at the server
# and have the following properties:
#   status-code: the corresponding http-status-code for the exception
#   description: a description for the exception, should be the same description as for the corresponding http-response
#   fullname: the name including the package (java-notation)
#    if specified, the exception is assumed to existent already,
#    if not specified the exception will be explicitly generated (using the exception name/key)
# TODO: another useful property: whether an exception is a runtime exception
x-knimegateway-exceptions:
  executor:
    NodeNotFound:
      name: NodeNotFoundException
      description: The requested node was not found.
      status-code: 404
    NotASubWorkflow:
      name: NotASubWorkflowException
      description: The requested node is not a sub-workflow (i.e. a meta- or sub-node), but is required to be.
      status-code: 400
    # more general not found exception (as opposed to the NodeNotFound exception)
    # - the actual cause can be found in the exception message 
    NotFound:
      name: NotFoundException
      description: A resource couldn't be found. Please refer to the exception message for more details.
      status-code: 404
    ActionNotAllowed:
      name: ActionNotAllowedException
      description: If an action is not allowed because it's not applicable or it doesn't exist. Please refer to the exception message for more details.
      status-code: 405
    NotSupported:
      name: NotSupportedException
      description: If the request is not supported for a reason. Please refer to the exception message for more details.
      status-code: 405
    InvalidSettings:
      name: InvalidSettingsException
      description: If settings couldn't be applied.
      status-code: 405
  server:
    NoPermission:
      fullname: com.knime.enterprise.utility.PermissionException
      description: if the current user does not have access permissions for the job
      status-code: 403
    ExecutorException:
      fullname: com.knime.enterprise.utility.ExecutorException
      description: if an error occurs while fetching job information from the RMI instance
      status-code: 500
    IOException:
      fullname: java.io.IOException
      description: IO error
      status-code: 500
    Timeout:
      fullname: java.util.concurrent.TimeoutException
      description: thrown when time to contact the executor has been exceeded
      status-code: 504

# For every http-response there should be a corresponding knimegateway-exception (see section above).
# These responses are mainly for documentation purposes and don't affect the code-generation.
responses:
  NodeNotFound:
    # should be the same description as for the corresponding knime-gateway exception (such that the generated documentation fits)
    description: The requested node was not found.
  NotFound:
    description: A resource couldn't be found.
  NotASubWorkflow:
    description: The requested node is not a sub-workflow (i.e. a meta- or sub-node), but is required to be.
  NoPermission:
    description: If the current user does not have access permissions for the job.
  InternalServerError:
    description: Internal server error, e.g. if an error occurs while fetching job information from the RMI.
  Timeout:
    description: When time to contact the executor has been exceeded.
  ActionNotAllowed:
    description: If the an action is not allowed because it's not applicable or it doesn't exist.
  NotSupported:
    description: If the request is not supported for a reason.
  InvalidSettings:
    description: If settings couldn't be applied.
  

# A comment on object/schema/model inheritance: polymorphism/subtyping in swagger is achieved by the 'allOf'-property
# and the specification of a 'dicriminator'-property to be able to tell them apart (see, e.g., Node).
# However, in Swagger 2.0 it has it's issues and it has been improved in OpenAPI 3.0 (introducing a mapping of
# discriminator-values to the respective schemas). Here, one could at least set the 'discriminator'-property
# to "read-only" and provide the respective default values in the spec already.
# But I chose to not clutter the API-spec too much at the expense of few actually unnecessary method calls within the
# generated java-code (the 'discriminator'-property has to be explicitly set every time an object is created). 
definitions:

  Annotation:
    description: A text annotation.
    type: object
    discriminator: type
    required:
     - type
    properties:
      type:
        description: Discriminator for inheritance. Must be the base name of this type/schema.
        type: string
      text:
        type: string
      backgroundColor:
        type: integer
      bounds:
        $ref: "#/definitions/Bounds"
      textAlignment:
        type: string
      borderSize:
        type: integer
      borderColor:
        type: integer
      defaultFontSize:
        type: integer
      version:
        type: integer
      styleRanges:
        description: Defines ranges of different styles within the annotation.
        type: array
        items:
          $ref: "#/definitions/StyleRange"
        
  Bounds:
    description: Node dimensions - position and size.
    type: object
    properties:
      x:
        type: integer
      y:
        type: integer
      width:
        type: integer
      height:
        type: integer
        
  Connection:
    description: A single connection between two nodes.
    type: object
    required:
      - dest
      - destPort
      - source
      - sourcePort
    properties:
      dest:
        type: string
        description: The destination node.
      destPort:
        type: integer
        description: The destination port, starting at 0.
      source:
        type: string
        description: The source node.
      sourcePort:
        type: integer
        description: The source port, starting at 0.
      deletable:
        type: boolean
        description: Whether the connection can currently be deleted.
      flowVariablePortConnection:
        type: boolean
        description: Whether it's a connection between two flow variable ports.
      bendPoints:
        type: array
        items:
           $ref: '#/definitions/XY'
      type:
        type: string
        enum: [STD, WFMIN, WFMOUT, WFMTHROUGH]
        description: The type of the connection (standard, workflow input / output /through).
  
  FlowVariable:
    description: Local variable of basic type which is passed along connections in a workflow.
    type: object
    properties:
      name:
        description: The flow variable's name.
        type: string
      type:
        description: The flow variables's type.
        type: string
        enum: [DOUBLE, INTEGER, STRING]
      value:
        description: The actual value.
        type: string
              
  JobManager:
    description: node's job manager
    type: object
    required:
      - id
    properties:
      id:
        type: string 

  MetaPortInfo:
    description: The port of a metanode.
    type: object
    required:
      - portType
    properties:
      portType:
        description: The type.
        $ref: "#/definitions/PortType"
      connected:
        description: Whether it is connected.
        type: boolean
      message:
        description: The message (summary of upstream node port).
        type: string
      oldIndex:
        description: The old index.
        type: integer
      newIndex:
        description: The new index.
        type: integer        
        
  NativeNode:
    description: Native node extension of a node.
    #inheritance
    allOf:
      - $ref: '#/definitions/Node'
      - type: object
        required:
          - nodeFactoryKey
        properties:
          nodeFactoryKey:
            description: The key/ID of the node factory defining all details.
            $ref: "#/definitions/NodeFactoryKey"
          inactive:
            description: Whether this node is inactive, e.g. due to inactive connections
            type: boolean
            
  NodeAnnotation:
    description: The annotation to a node.
    allOf:
      - $ref: "#/definitions/Annotation"
      - type: object
        properties:
          default:
            description: Default node annotation.
            type: boolean
    
  Node:
    description: A node.
    type: object
    required:
      - name
      - nodeID
      - nodeType
      - nodeState
      - type
      - rootWorkflowID
    discriminator: type
    properties:
      type:
        type: string
        description: Discriminator for inheritance. Must be the base name of this type/schema.
      name:
        description: The node's name.
        type: string
      nodeID:
        description: The ID of the node.
        type: string
      nodeType:
        description: The type of the node.
        type: string
        enum: [
                Source,
                Sink,
                Learner,
                Predictor,
                Manipulator,
                Visualizer,
                Meta,
                LoopStart,
                LoopEnd,
                ScopeStart,
                ScopeEnd,
                QuickForm,
                Other,
                Missing,
                Unknown,
                Subnode,
                VirtualIn,
                VirtualOut
              ]
      parentNodeID:
        description: The parent node id of the node or "root" if it's the root node/workflow.
        type: string
      rootWorkflowID:
        description: The id of the root workflow this node is contained in or represents.
        type: string
        format: uuid
      nodeMessage:
        description: The current node message (warning, error, none).
        $ref: '#/definitions/NodeMessage'
      nodeState:
        description: The state of the node.
        $ref: "#/definitions/NodeState"
      progress:
        description: The node's progress.
        $ref: "#/definitions/NodeProgress"
      inPorts:
        description: The list of inputs.
        type: array
        items:
          $ref: "#/definitions/NodeInPort"
      outPorts:
        description: The list of outputs.
        type: array
        items:
          $ref: "#/definitions/NodeOutPort"
      deletable:
        description: Whether the node is deletable.
        type: boolean
        default: false
      resetable:
        description: Whether the node is resetable. Please note that it only represents the 'local' reset-state but doesn't take the whole workflow into account (e.g. executing successors).
        type: boolean
        default: false
      hasDialog:
        description: Whether the node has a configuration dialog / user settings.
        type: boolean
      nodeAnnotation:
        description: The annotation below the node.
        $ref: "#/definitions/NodeAnnotation"
      jobManager:
        description: The job manager (e.g. cluster or streaming).
        $ref: '#/definitions/JobManager'
      uIInfo:
        $ref: "#/definitions/NodeUIInfo"
        
  NodeFactoryKey:
    description: Object to identify a node-specific node implementation.
    type: object
    required:
      - className
    properties:
      className:
        description: The fully qualified java classname.
        type: string
      settings:
        description: Additional settings in order to be able to re-create nodes. Only required in case of 'dynamic' node factories.
        type: string
      
  NodeInPort:
    description: An input port of a node.
    allOf:
      - $ref: "#/definitions/NodePort"
        
  NodeMessage:
    description: node message
    type: object
    required:
     - message
    properties:
      type:
        type: string
      message:
        type: string
        
  NodeOutPort:
    description: The output port of a node.
    allOf:
      - $ref: "#/definitions/NodePort"
      - type: object
        properties:
          inactive:
            description: Determines whether the output is inactive.  
            type: boolean
        
  NodePort:
    description: A single port of a node.
    type: object
    discriminator: type
    required:
    - type
    - portIndex
    - portType
    properties:
      type:
        description: Discriminator for inheritance. Must be the base name of this type/schema.
        type: string
      portIndex:
        description: The index starting at 0.
        type: integer
      portType:
        description: The type of the port.
        $ref: "#/definitions/PortType"
      portName:
        description: The name of the port.
        type: string
  
  NodeProgress:
    description: Represents the node's progress.
    type: object
    properties:
      progress:
        description: The actual progress, a value between 0 and 1.
        type: number
      message:
        description: A progress message.
        type: string

  NodeState:
    type: object
    required:
      - state
    properties:
      state:
        type: string
        enum: [
                IDLE,
                CONFIGURED,
                UNCONFIGURED_MARKEDFOREXEC,
                CONFIGURED_MARKEDFOREXEC,
                EXECUTED_MARKEDFOREXEC,
                CONFIGURED_QUEUED,
                EXECUTED_QUEUED,
                PREEXECUTE,
                EXECUTING,
                EXECUTINGREMOTELY,
                POSTEXECUTE,
                EXECUTED
              ]

      
  NodeUIInfo:
    type: object
    properties:
      bounds:
        $ref: "#/definitions/Bounds"
      symbolRelative:
        type: boolean
      hasAbsoluteCoordinates:
        type: boolean
      dropLocation:
        type: boolean
      snapToGrid:
        type: boolean 

  Patch:
    description: A list of patch operations.
    type: object
    properties:
      ops:
        description: The operations that make up this patch.
        type: array
        items:
          $ref: "#/definitions/PatchOp" 
      snapshotID:
        description: A unique identifier for the version of the object this patch is applied to. Should only be missing if the patch is empty!
        type: string
        format: uuid
      targetTypeID:
        description: ID of the entity this patch can exclusively be applied to. Should only be missing, if the patch is empty!
        type: string

  PatchOp: 
    description: A JSONPatch document as defined by RFC 6902 
    type: object
    required:
     - "op"
     - "path"
    properties: 
     op: 
      type: string 
      description: The operation to be performed 
      enum:
       - "add"
       - "remove"
       - "replace"
       - "move"
       - "copy"
       - "test"
     path: 
      type: string 
      description: A JSON-Pointer 
     value: 
      type: object 
      description: The value to be used within the operations.
     from: 
      type: string 
      description: A string containing a JSON Pointer value.      
  
  PortObjectSpec:
    description: Specification of a port object.
    type: object
    required:
      - type
      - inactive
    properties:
      type:
        description: The port type the specification refers to.
        $ref: "#/definitions/PortType"
      representation:
        description: The actual port object spec representation.
        type: string
      inactive:
        description: Flag indicating whether the port is inactive. If true, there will be no representation available.
        type: boolean

  PortType:
    description: The type of a port.
    type: object
    required:
     - portObjectClassName
     - optional
    properties:
      portObjectClassName:
        description: Port type class name (for coloring, connection checks).
        type: string
      optional:
        description: Whether the port is optional, only applies to input ports.
        type: boolean
  
  NodeSettings:
    description: Settings of a node.
    type: object
    properties:
      content:
        description: The actual settings as a json-string.
        type: string
    x-knimegateway-isUsedAsParameter: true
        
  StyleRange:
    description: Defines the style of a range (e.g. within a workflow annotation).
    type: object
    properties:
      start:
        description: Style range start.
        type: integer
      length:
        description: Style range length.
        type: integer
      fontName:
        description: Style range font name.
        type: string
      fontStyle:
        description: The font style, e.g. normal, bold or italic.
        type: string
        enum: [normal, bold, italic]
      fontSize:
        description: Style range font size.
        type: integer
      foregroundColor:
        description: Style range foreground color.
        type: integer
        
  WorkflowAnnotation:
    description: A workflow annotation.
    allOf:
      - $ref: "#/definitions/Annotation"
        
  Workflow:
    type: object
    description: The structure of a workflow.
    properties:
      nodes:
        description: The node map.
        #string to Node map
        type: object
        additionalProperties:
          type: object
          $ref: '#/definitions/Node'
      connections:
        description: The list of connections.
        type: array
        items:
          $ref: '#/definitions/Connection'
      metaInPortInfos:
        description: The inputs of a metanode (if this workflow is one).
        type: array
        items:
          $ref: "#/definitions/MetaPortInfo"
      metaOutPortInfos:
        description: The outputs of a metanode (if this workflow is one).
        type: array
        items:
          $ref: "#/definitions/MetaPortInfo"
      workflowAnnotations:
        description: List of all workflow annotations. TODO could be moved to an extra UI service in order to not polute the WorkflowEnt too much and separate UI logics.
        type: array
        items:
          $ref: "#/definitions/WorkflowAnnotation"
      workflowUIInfo:
        description: Additional workflow UI information such as grid settings, connection appearance etc. TODO could be moved to an extra UI service in order to not polute the WorkflowEnt too much and separate UI logics.
        $ref: "#/definitions/WorkflowUIInfo"
      hasCredentials:
        description: Flag indicating whether the workflow has credentials stored.
        type: boolean
       
  WorkflowNode:
    description: A node containing (referencing) a workflow (also referred to it as metanode)
    allOf:
      - $ref: "#/definitions/Node"
      - type: object
        properties:
          workflowIncomingPorts:
            description: List of all incoming workflow ports.
            type: array
            items:
              $ref: "#/definitions/NodeOutPort"
          workflowOutgoingPorts:
            description: List of all outgoing workflow ports.
            type: array
            items:
              $ref: "#/definitions/NodeInPort"
          encrypted:
            description: Whether the referenced workflow is encrypted is required to be unlocked before it can be accessed.
            type: boolean
          workflowOutgoingPortNodeStates:
            description: The state of the inner node connected to a particular outport. TODO Should actually be part of a specialization of NodeOutPort (i.e. WorkflowOutPort) but doesn't work with inheritance and generics in Java.
            type: array
            items:
              $ref: "#/definitions/NodeState"

  WorkflowSnapshot:
    description: A workflow with an additional snapshot id.
    type: object
    required:
      - workflow
      - snapshotID
    properties:
      workflow:
        description: The actual workflow.
        $ref: "#/definitions/Workflow"
      snapshotID:
        description: A unique identifier for the snapshot.
        type: string
        format: uuid
  
  WorkflowUIInfo:
    description: Contains workflow UI-related properties such as grid settings, connection appearance etc. 
    type: object
    properties:
      gridX:
        description: Grid size in X direction.
        type: integer
      gridY:
        description: Grid size in Y direction.
        type: integer
      snapToGrid:
        description: Whether to snap to the grid.
        type: boolean
      showGrid:
        description: Whether to show the grid lines.
        type: boolean
      zoomLevel:
        description: Workflow zoom leve, i.e. its magnification.
        type: number
      hasCurvedConnection:
        description: Whether connections are rendered as curves.
        type: boolean
      connectionLineWidth:
        description: Width of the line connecting two nodes.
        type: integer
        
  WrappedWorkflowNode:
    description: A node wrapping (referencing) a workflow (also referred to it as wrapped metanode or subnode) that almost behaves as a ordinary node.
    allOf:
      - $ref: "#/definitions/WorkflowNode"
      - type: object
        properties:
          virtualInNodeID:
            description: Node ID of the virtual in-node (i.e. source).
            type: string
          virtualOutNodeID:
            description: Node ID of the virtual out-node (i.e. sink).
            type: string
          inactive:
            description: Whether this node is inactive, e.g. due to inactive connections
            type: boolean
 
                    
  XY:
    type: object
    description: XY coordinate
    properties:
      x:
        type: integer
      y:
        type: integer
    
        
